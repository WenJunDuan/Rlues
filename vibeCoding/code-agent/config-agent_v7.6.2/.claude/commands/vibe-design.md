# /vibe-design

## 用途
专注于架构设计，输出设计文档

## 语法
```bash
/vibe-design <设计描述>
```

## 与其他指令区别
| 指令 | 侧重 | 输出 |
|:---|:---|:---|
| /vibe-code | 完整开发 | 代码变更 |
| /vibe-plan | 任务规划 | TODO.md |
| /vibe-design | 架构设计 | 设计文档 |

## 执行流程

### 1. 深度 Research
```yaml
加载: skills/research.md

执行:
  - 全面分析现有架构
  - 理解设计需求
  - 识别技术约束
  - 调研相关方案

MCP:
  - sou: 深度代码搜索
  - context7: 需求文档分析
  - memory: 查询历史决策
```

### 2. Innovate 设计
```yaml
加载: skills/innovate.md
角色: agents/architect.md

执行:
  - 方案探索与比较
  - 架构设计
  - 模块划分
  - 接口定义
  - 技术选型
  - 风险评估

MCP:
  - sequential-thinking: 深度架构推理
  - memory: 存储设计决策
```

### 3. 输出文档
```yaml
输出到: .ai_state/architecture.md

内容:
  - 系统概览
  - 架构图/描述
  - 模块职责
  - 接口契约
  - 技术选型
  - 风险与缓解
```

### 4. 寸止
```yaml
触发: [DESIGN_FREEZE]

输出:
  - 设计摘要
  - 关键决策
  - 后续建议

等待: 用户确认
  - 继续开发 → /vibe-code --continue
  - 修改设计 → 根据反馈调整
  - 仅保存 → 保留设计文档
```

## 输出模板
```markdown
## 架构设计: [主题]

### 1. 概述
[问题背景和设计目标]

### 2. 系统架构
[架构图或描述]

### 3. 模块划分
| 模块 | 职责 | 接口 |
|:---|:---|:---|
| ModuleA | ... | ... |
| ModuleB | ... | ... |

### 4. 接口定义
\`\`\`typescript
interface IExample {
  // ...
}
\`\`\`

### 5. 数据流
[数据如何在系统中流动]

### 6. 技术选型
| 决策点 | 选择 | 原因 |
|:---|:---|:---|
| 框架 | ... | ... |
| 存储 | ... | ... |

### 7. 风险评估
| 风险 | 影响 | 缓解策略 |
|:---|:---|:---|
| ... | ... | ... |

### 8. 后续步骤
- [ ] 步骤1
- [ ] 步骤2
```

## 使用场景

### 新功能设计
```bash
/vibe-design "设计插件系统架构"
```

### 重构规划
```bash
/vibe-design "重新设计数据访问层"
```

### 技术选型
```bash
/vibe-design "评估并选择状态管理方案"
```

## 示例输出
```markdown
## [DESIGN_FREEZE] 设计完成

### 主题
插件系统架构设计

### 关键决策
1. 采用事件驱动架构
2. 插件通过 manifest.json 注册
3. 使用 VM2 实现沙箱隔离

### 模块划分
- PluginManager: 插件生命周期管理
- PluginLoader: 加载和验证插件
- PluginSandbox: 安全执行环境
- PluginRegistry: 插件注册表

### 风险
- 性能开销: 通过懒加载缓解
- 安全风险: 通过沙箱隔离

### 选项
1. 继续开发实现
2. 修改设计
3. 仅保存设计文档
```
