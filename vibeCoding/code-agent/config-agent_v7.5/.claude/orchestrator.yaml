# orchestrator.yaml
# AI 调度配置文件 - VibeCoding v7.4
# 
# 原则：
# 1. 用户指令优先于配置
# 2. 未配置的角色使用 default_engine
# 3. 配置仅作为默认建议，不是强制限制

# ============================================================
# 主 AI 引擎配置
# ============================================================
default_engine:
  name: claude-code          # 主 AI 引擎 (claude-code | codex | gemini)
  # model: claude-sonnet-4-20250514  # 具体模型（可选）
  
# 当主引擎不可用时的降级顺序
fallback_order:
  - codex
  - gemini

# ============================================================
# 可用引擎定义
# ============================================================
engines:
  claude-code:
    enabled: true
    invocation: direct        # 直接会话
    
  codex:
    enabled: true
    invocation: cli           # CLI 调用
    command: "codex"
    args: []
    
  gemini:
    enabled: true
    invocation: cli
    command: "gemini"
    args: []

# ============================================================
# 角色 → 引擎映射（可选配置）
# 未配置的角色使用 default_engine
# ============================================================
role_engine_mapping:
  # pm: claude-code          # 项目经理
  # pdm: claude-code         # 产品经理
  # ar: claude-code          # 架构师
  # ld: codex                # 开发者 - 示例：可指定用 codex
  # qe: claude-code          # 质量工程师
  # sa: claude-code          # 安全审计
  # ui: claude-code          # UI设计师

# ============================================================
# 任务类型 → 引擎映射（可选配置）
# 仅作为智能建议，用户指令优先
# ============================================================
task_type_hints:
  # architecture: claude-code
  # quick_fix: codex
  # parallel_tasks: codex
  # long_context: gemini
  # multimodal: gemini

# ============================================================
# 并行执行配置
# ============================================================
parallel:
  enabled: true
  max_concurrent: 3          # 最大并行任务数
  preferred_engine: codex    # 并行任务首选引擎

# ============================================================
# 状态同步配置
# ============================================================
sync:
  # 状态文件位置（所有 AI 的唯一真理来源）
  state_dir: "project_document/.ai_state"
  
  # 同步文件
  files:
    - active_context.md      # 当前任务状态
    - kanban.md              # 进度看板
    - handoff.md             # 任务交接记录
    
  # 锁机制
  lock_file: ".ai_lock"      # 防止并发写入冲突
  lock_timeout: 300          # 锁超时时间（秒）

# ============================================================
# 任务交接协议
# ============================================================
handoff:
  # 交接时必须包含的信息
  required_fields:
    - task_id
    - from_engine
    - to_engine
    - context_summary
    - completed_work
    - pending_work
    - files_modified
    
  # 交接文件位置
  handoff_file: "project_document/.ai_state/handoff.md"

# ============================================================
# 用户覆盖规则
# ============================================================
# 用户可以通过以下方式覆盖配置：
#
# 1. 指令参数：
#    /vibe-code --engine=codex "任务描述"
#    /vibe-code --engine=gemini "任务描述"
#
# 2. 会话内指定：
#    "用 codex 来完成这个任务"
#    "让 gemini 处理这个"
#
# 3. 角色切换：
#    "这个任务让 LD 用 codex 做"
#
# 优先级: 用户指令 > role_engine_mapping > task_type_hints > default_engine
