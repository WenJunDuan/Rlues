# vibe-plan

## 类型
🔷 **增强官方指令** - 基于 `/plan`

## 用途
生成增强的开发计划，融合知识库和经验库

## 语法
```bash
vibe-plan [任务描述]
vibe-plan --continue          # 继续当前计划
```

## 执行流程

```
vibe-plan "实现用户认证"
    │
    ▼
┌─────────────────────────────┐
│ 1. 调用官方 /plan           │ ← 进入计划模式
│    - 官方计划能力           │
│    - 官方统计正常记录        │
└─────────────┬───────────────┘
              │
              ▼
┌─────────────────────────────┐
│ 2. 知识库检索               │ ← knowledge-base skill
│    - 项目背景               │
│    - 开发规范               │
│    - 技术约束               │
└─────────────┬───────────────┘
              │
              ▼
┌─────────────────────────────┐
│ 3. 经验库检索               │ ← experience skill
│    - 类似任务经验           │
│    - 最佳实践               │
│    - 踩坑教训               │
└─────────────┬───────────────┘
              │
              ▼
┌─────────────────────────────┐
│ 4. 增强计划生成             │ ← riper/plan skill
│    - 结构化 TODO.md         │
│    - 任务依赖分析           │
│    - 时间估算               │
│    - 风险识别               │
└─────────────┬───────────────┘
              │
              ▼
┌─────────────────────────────┐
│ 5. 状态同步                 │
│    - 更新 kanban.md         │
│    - 更新 session.lock      │
└─────────────┬───────────────┘
              │
              ▼
        [PLAN_READY]          ← 寸止等待确认
```

## 官方 /plan vs vibe-plan

| 维度 | 官方 /plan | vibe-plan |
|:---|:---|:---|
| 计划模式 | ✅ | ✅ 继承 |
| 统计追踪 | ✅ | ✅ 继承 |
| 知识库 | ❌ | ✅ 增强 |
| 经验库 | ❌ | ✅ 增强 |
| 结构化输出 | 基础 | ✅ 增强 TODO.md |
| 状态管理 | ❌ | ✅ .ai_state/ |
| 寸止机制 | ❌ | ✅ [PLAN_READY] |

## 输出格式

### TODO.md (增强版)
```markdown
# TODO: 实现用户认证

## 元信息
- 任务ID: REQ-001
- 创建时间: 2025-01-01
- 预计耗时: 2小时
- 路径: Path B

## 知识库参考
- 参考: standards/security.md (认证规范)
- 参考: tech/jwt.md (JWT 使用指南)

## 经验参考
- EXP-012: JWT vs Session 选择 (推荐JWT)
- EXP-023: 密码加密最佳实践

## 任务列表

### Phase 1: 准备 [30min]
- [ ] 创建类型定义 `types/auth.ts`
- [ ] 创建工具函数 `utils/crypto.ts`

### Phase 2: 实现 [1h]
- [ ] 实现登录 API `api/auth/login.ts`
- [ ] 实现注册 API `api/auth/register.ts`
- [ ] 实现中间件 `middleware/auth.ts`

### Phase 3: 测试 [30min]
- [ ] 单元测试
- [ ] 集成测试

## 风险
- 安全风险: 确保使用 bcrypt 加密

## 下一步
确认计划后执行 `vibe-dev REQ-001 --develop`
```

## MCP 工具调用
```yaml
必用:
  - memory: 查询历史计划
  
推荐:
  - sou: 搜索相关代码
  - sequential-thinking: 复杂任务分解
```

## 使用示例

### 新建计划
```bash
vibe-plan "添加用户搜索功能"

# 输出:
# 1. 进入计划模式 (官方 /plan)
# 2. 检索到 2 条知识库文档
# 3. 检索到 3 条相关经验
# 4. 生成 TODO.md
# 5. [PLAN_READY] 请确认计划
```

### 继续计划
```bash
vibe-plan --continue

# 继续上次未完成的计划
```

## 寸止点
```yaml
Token: [PLAN_READY]
时机: TODO.md 生成后
等待: 用户确认计划

用户选项:
  1. 确认 → 继续开发
  2. 修改 → 调整计划
  3. 取消 → 放弃计划
```
