---
name: session-manager
description: ä¼šè¯çŠ¶æ€ç®¡ç†ï¼Œä¿è¯å·¥ä½œæµè·¨ä¼šè¯æŒä¹…åŒ–
trigger: æ¯æ¬¡ä¼šè¯å¼€å§‹æ—¶å¼ºåˆ¶åŠ è½½
priority: highest
---

# Session Manager Skill

> **æ ¸å¿ƒé—®é¢˜**: å¦‚ä½•ä¿è¯å·¥ä½œæµåœ¨ä¼šè¯æ–­å¼€åä»ç„¶ç”Ÿæ•ˆï¼Ÿ
> **è§£å†³æ–¹æ¡ˆ**: å¼ºåˆ¶çŠ¶æ€æŒä¹…åŒ– + å¼ºåˆ¶æ¢å¤æ£€æŸ¥ + æ¨¡å¼é”å®š

---

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

1. **ä¼šè¯æ–­å¼€ä¸ä¸¢å¤±çŠ¶æ€** â€” æ‰€æœ‰çŠ¶æ€æŒä¹…åŒ–åˆ°æ–‡ä»¶
2. **æ–°ä¼šè¯è‡ªåŠ¨æ¢å¤æ¨¡å¼** â€” ä¸é€€åŒ–ä¸ºæ™®é€šå¯¹è¯
3. **å·¥ä½œæµé”å®š** â€” ç›´åˆ°æµç¨‹å®Œæˆæ‰èƒ½åˆ‡æ¢

---

## ğŸ“ ä¼šè¯çŠ¶æ€æ–‡ä»¶

```
project_document/.ai_state/
â”œâ”€â”€ session.yaml          # ğŸ†• ä¼šè¯çŠ¶æ€ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ active_context.md     # å½“å‰ä»»åŠ¡å’ŒTODO
â”œâ”€â”€ kanban.md             # ä¸‰æ€çœ‹æ¿
â”œâ”€â”€ workflow.lock         # ğŸ†• å·¥ä½œæµé”
â””â”€â”€ checkpoint.md         # ğŸ†• æ–­ç‚¹æ¢å¤ä¿¡æ¯
```

### session.yaml ç»“æ„

```yaml
# ä¼šè¯çŠ¶æ€ - æ¯æ¬¡æ“ä½œéƒ½è¦æ›´æ–°
session:
  id: "sess_20250112_001"
  created_at: "2025-01-12T10:00:00Z"
  updated_at: "2025-01-12T10:30:00Z"
  
# å½“å‰æ¨¡å¼ - å†³å®šAIè¡Œä¸ºæ–¹å¼
mode:
  type: "workflow"           # workflow | conversation | paused
  workflow_name: "vibe-code" # å½“å‰æ‰§è¡Œçš„å·¥ä½œæµ
  phase: "E"                 # R1 | I | P | E | R2
  step: "4.3"                # å½“å‰æ­¥éª¤
  
# å·¥ä½œæµçŠ¶æ€
workflow:
  started_at: "2025-01-12T10:00:00Z"
  current_task: "T-002"
  total_tasks: 5
  completed_tasks: 1
  status: "running"          # running | paused | completed | failed
  
# ä¸Šä¸‹æ–‡æ‘˜è¦ - ç”¨äºæ¢å¤
context:
  goal: "å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ"
  last_action: "å®Œæˆäº†æ•°æ®æ¨¡å‹è®¾è®¡"
  next_action: "å®ç°APIæ¥å£"
  pending_questions: []
  
# æ–­ç‚¹ä¿¡æ¯ - ç”¨äºç²¾ç¡®æ¢å¤
checkpoint:
  file: "src/api/auth.ts"
  line: 45
  action: "implementing login function"
```

### workflow.lock ç»“æ„

```yaml
# å·¥ä½œæµé” - é˜²æ­¢æ¨¡å¼åˆ‡æ¢
locked: true
workflow: "vibe-code"
reason: "å·¥ä½œæµæ‰§è¡Œä¸­ï¼Œéœ€å®Œæˆåæ‰èƒ½åˆ‡æ¢"
unlock_conditions:
  - "æ‰€æœ‰TODOå®Œæˆ"
  - "ç”¨æˆ·é€šè¿‡å¯¸æ­¢ç¡®è®¤"
  - "ç”¨æˆ·ä¸»åŠ¨è§£é” /vibe-unlock"
```

---

## ğŸ”„ ä¼šè¯ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¼šè¯ç”Ÿå‘½å‘¨æœŸ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ–°ä¼šè¯å¼€å§‹                                                  â”‚
â”‚       â†“                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Step 1: å¼ºåˆ¶æ£€æŸ¥ session.yaml                       â”‚   â”‚
â”‚  â”‚         æ˜¯å¦å­˜åœ¨ï¼ŸçŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿ                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â†“                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Step 2: æ£€æŸ¥ workflow.lock                          â”‚   â”‚
â”‚  â”‚         æ˜¯å¦æœ‰æœªå®Œæˆçš„å·¥ä½œæµï¼Ÿ                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â†“                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ æœ‰é”ï¼Ÿ                               â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚                                                     â”‚
â”‚    Yesâ”‚                    No                               â”‚
â”‚       â†“                    â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ æ¢å¤æ¨¡å¼    â”‚    â”‚ æ™®é€šæ¨¡å¼    â”‚                        â”‚
â”‚  â”‚ ç»§ç»­å·¥ä½œæµ  â”‚    â”‚ ç­‰å¾…æŒ‡ä»¤    â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¼ºåˆ¶å¯åŠ¨åºåˆ—

**æ¯æ¬¡ä¼šè¯å¼€å§‹å¿…é¡»æ‰§è¡Œ**ï¼ˆæ— ä¾‹å¤–ï¼‰ï¼š

```javascript
async function onSessionStart() {
  // ========== ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥çŠ¶æ€æ–‡ä»¶ ==========
  const sessionFile = 'project_document/.ai_state/session.yaml';
  const lockFile = 'project_document/.ai_state/workflow.lock';
  
  const sessionExists = await fileExists(sessionFile);
  const lockExists = await fileExists(lockFile);
  
  // ========== ç¬¬äºŒæ­¥ï¼šæ ¹æ®çŠ¶æ€å†³å®šè¡Œä¸º ==========
  if (lockExists) {
    const lock = await readYaml(lockFile);
    if (lock.locked) {
      // ğŸ”’ æœ‰é”ï¼šå¼ºåˆ¶æ¢å¤å·¥ä½œæµæ¨¡å¼
      await resumeWorkflow(lock.workflow);
      return;
    }
  }
  
  if (sessionExists) {
    const session = await readYaml(sessionFile);
    if (session.mode.type === 'workflow') {
      // ğŸ“‹ æœ‰æœªå®Œæˆå·¥ä½œæµï¼šæ¢å¤
      await resumeWorkflow(session.mode.workflow_name);
      return;
    }
    if (session.mode.type === 'paused') {
      // â¸ï¸ æš‚åœçŠ¶æ€ï¼šæç¤ºç”¨æˆ·
      await notifyPausedState(session);
      return;
    }
  }
  
  // ========== ç¬¬ä¸‰æ­¥ï¼šæ— çŠ¶æ€ï¼Œç­‰å¾…æŒ‡ä»¤ ==========
  await waitForCommand();
}
```

---

## ğŸ“¢ æ¢å¤æ—¶çš„æ±‡æŠ¥æ ¼å¼

**å¿…é¡»**ç”¨è¿™ç§æ ¼å¼æ±‡æŠ¥ï¼Œä¸æ˜¯æ™®é€šå¯¹è¯ï¼š

```markdown
## ğŸ”„ ä¼šè¯æ¢å¤

### å½“å‰çŠ¶æ€
- **å·¥ä½œæµ**: vibe-code
- **é˜¶æ®µ**: Execute (E)
- **è¿›åº¦**: 2/5 ä»»åŠ¡å®Œæˆ (40%)

### ä¸Šæ¬¡è¿›å±•
- âœ… T-001: æ•°æ®æ¨¡å‹è®¾è®¡
- âœ… T-002: ç”¨æˆ·æ¥å£å®šä¹‰
- ğŸ”„ T-003: å®ç°ç™»å½•API (è¿›è¡Œä¸­)

### ä¸‹ä¸€æ­¥
ç»§ç»­æ‰§è¡Œ T-003: å®ç°ç™»å½•API

### æ–­ç‚¹ä½ç½®
- æ–‡ä»¶: `src/api/auth.ts`
- è¿›åº¦: ç™»å½•å‡½æ•°æ¡†æ¶å·²å®Œæˆï¼Œå¾…å®ç°éªŒè¯é€»è¾‘

---

**æ˜¯å¦ç»§ç»­ï¼Ÿ** å›å¤ `ç»§ç»­` æˆ– `æŸ¥çœ‹è¯¦æƒ…` æˆ– `æš‚åœ`
```

---

## ğŸ” æ¨¡å¼é”å®šæœºåˆ¶

### è¿›å…¥å·¥ä½œæµæ—¶é”å®š

```javascript
async function enterWorkflow(workflowName) {
  // åˆ›å»ºé”
  await writeYaml('project_document/.ai_state/workflow.lock', {
    locked: true,
    workflow: workflowName,
    locked_at: new Date().toISOString(),
    reason: 'å·¥ä½œæµæ‰§è¡Œä¸­',
    unlock_conditions: [
      'æ‰€æœ‰TODOå®Œæˆå¹¶é€šè¿‡å¯¸æ­¢ç¡®è®¤',
      'ç”¨æˆ·ä¸»åŠ¨æ‰§è¡Œ /vibe-unlock',
      'ç”¨æˆ·æ‰§è¡Œ /vibe-pause'
    ]
  });
  
  // æ›´æ–°ä¼šè¯çŠ¶æ€
  await updateSession({
    mode: {
      type: 'workflow',
      workflow_name: workflowName,
      phase: 'R1',
      step: '1.1'
    }
  });
}
```

### è§£é”æ¡ä»¶

```javascript
async function checkUnlock() {
  const canUnlock = 
    allTodosCompleted() &&
    userConfirmedViaCunzhi() &&
    noBlockingIssues();
    
  if (canUnlock) {
    await releaseLock();
  }
}
```

---

## â¸ï¸ æš‚åœå’Œæ¢å¤

### æš‚åœæŒ‡ä»¤: /vibe-pause

```javascript
async function pause() {
  // ä¿å­˜æ–­ç‚¹
  await writeFile('project_document/.ai_state/checkpoint.md', `
# æ–­ç‚¹ä¿¡æ¯

## æš‚åœæ—¶é—´
${new Date().toISOString()}

## å½“å‰ä½ç½®
- å·¥ä½œæµ: ${currentWorkflow}
- é˜¶æ®µ: ${currentPhase}
- ä»»åŠ¡: ${currentTask}
- æ–‡ä»¶: ${currentFile}

## å¾…ç»§ç»­å·¥ä½œ
${pendingWork}

## æ¢å¤æŒ‡ä»¤
ä½¿ç”¨ /vibe-resume ç»§ç»­
  `);
  
  // æ›´æ–°çŠ¶æ€
  await updateSession({ mode: { type: 'paused' } });
  await updateLock({ locked: false, paused: true });
}
```

### æ¢å¤æŒ‡ä»¤: /vibe-resume

```javascript
async function resume() {
  const checkpoint = await readFile('checkpoint.md');
  const session = await readYaml('session.yaml');
  
  // æ¢å¤åˆ°æ–­ç‚¹
  await restoreCheckpoint(checkpoint);
  
  // é‡æ–°é”å®š
  await enterWorkflow(session.mode.workflow_name);
  
  // æ±‡æŠ¥å¹¶ç»§ç»­
  await reportAndContinue();
}
```

---

## ğŸ“‹ çŠ¶æ€æ›´æ–°æ—¶æœº

| äº‹ä»¶ | æ›´æ–°å†…å®¹ |
|:---|:---|
| å¼€å§‹å·¥ä½œæµ | session.yaml + workflow.lock |
| è¿›å…¥æ–°é˜¶æ®µ | session.yaml (phase) |
| å®Œæˆä»»åŠ¡ | session.yaml + kanban.md |
| æš‚åœ | session.yaml + checkpoint.md |
| æ¢å¤ | session.yaml |
| å®Œæˆå·¥ä½œæµ | åˆ é™¤ workflow.lock |

---

## âš ï¸ å¼ºåˆ¶è§„åˆ™

1. **æ¯æ¬¡ä¼šè¯å¼€å§‹å¿…é¡»æ£€æŸ¥çŠ¶æ€** â€” æ— ä¾‹å¤–
2. **æœ‰é”å¿…é¡»æ¢å¤å·¥ä½œæµ** â€” ä¸èƒ½å¿½ç•¥
3. **ä¸èƒ½åœ¨å·¥ä½œæµä¸­åˆ‡æ¢åˆ°å¯¹è¯æ¨¡å¼** â€” é™¤éè§£é”
4. **çŠ¶æ€æ–‡ä»¶æ˜¯å”¯ä¸€çœŸç†** â€” ä¸ä¾èµ–ä¼šè¯è®°å¿†

---

## ğŸ”— ä¸å…¶ä»–æŠ€èƒ½åä½œ

| æŠ€èƒ½ | åä½œ |
|:---|:---|
| lifecycle | æä¾›ç”Ÿå‘½å‘¨æœŸé’©å­ |
| memory | åŠ è½½ç”¨æˆ·åå¥½ |
| cunzhi | å·¥ä½œæµç»“æŸç¡®è®¤ |

---

**æ ¸å¿ƒä»·å€¼**: ä¿è¯å·¥ä½œæµè·¨ä¼šè¯æŒä¹… | **è§¦å‘**: æ¯æ¬¡ä¼šè¯å¼€å§‹ | **ä¼˜å…ˆçº§**: æœ€é«˜
