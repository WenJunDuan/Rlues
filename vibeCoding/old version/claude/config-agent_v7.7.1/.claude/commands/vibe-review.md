# vibe-review

## 类型
🔷 **增强官方指令** - 基于 `/review`

## 用途
增强代码审查，融合知识库规范和经验库最佳实践

## 语法
```bash
vibe-review                   # 审查当前变更
vibe-review <文件路径>        # 审查指定文件
vibe-review --security        # 含安全审查 (调用 /security-review)
vibe-review --quality         # 深度质量检查
```

## 执行流程

```
vibe-review
    │
    ▼
┌─────────────────────────────┐
│ 1. 调用官方 /review         │ ← 官方代码审查
│    - 标准审查               │
│    - 官方统计正常记录        │
└─────────────┬───────────────┘
              │
              ▼
┌─────────────────────────────┐
│ 2. 知识库检索               │ ← knowledge-base skill
│    - 审查清单               │
│    - 代码规范               │
│    - 安全要求               │
└─────────────┬───────────────┘
              │
              ▼
┌─────────────────────────────┐
│ 3. 经验库检索               │ ← experience skill
│    - 常见问题               │
│    - 踩坑教训               │
│    - 最佳实践               │
└─────────────┬───────────────┘
              │
              ▼
┌─────────────────────────────┐
│ 4. 增强审查                 │
│    - riper/review skill     │
│    - code-quality skill     │
│    - Linus 品味检查         │
└─────────────┬───────────────┘
              │
              ▼
┌─────────────────────────────┐
│ 5. 经验沉淀                 │ ← experience skill
│    - 发现的问题             │
│    - 好的实践               │
└─────────────────────────────┘
```

## 官方 /review vs vibe-review

| 维度 | 官方 /review | vibe-review |
|:---|:---|:---|
| 代码审查 | ✅ | ✅ 继承 |
| 统计追踪 | ✅ | ✅ 继承 |
| 知识库规范 | ❌ | ✅ 增强 |
| 经验库匹配 | ❌ | ✅ 增强 |
| Linus 品味检查 | ❌ | ✅ 增强 |
| 经验沉淀 | ❌ | ✅ 增强 |

## 审查清单 (知识库驱动)

### 自动加载
```yaml
若 .knowledge/standards/review-checklist.md 存在:
  → 自动加载作为审查清单

若不存在:
  → 使用内置清单 (code-quality skill)
```

### 内置清单 (Linus 品味)
```markdown
## 必检项

### 简洁性
- [ ] 这是最简单的实现方式吗？
- [ ] 有没有更直接的方法？
- [ ] 三个月后能理解这段代码吗？
- [ ] 这个抽象真的需要吗？

### 质量
- [ ] 函数是否单一职责？
- [ ] 命名是否清晰？
- [ ] 错误处理是否完善？
- [ ] 是否有重复代码？

### 安全
- [ ] 输入是否验证？
- [ ] 敏感数据是否处理？
- [ ] 是否有注入风险？

### 性能
- [ ] 是否有明显性能问题？
- [ ] 是否有 N+1 查询？
```

## 输出格式

```markdown
## 代码审查报告

### 基础审查 (官方 /review)
[官方审查结果]

---

### 增强审查 (VibeCoding)

#### 知识库规范检查
- ✅ 符合: 命名规范 (standards/code-style.md)
- ⚠️ 建议: 添加 JSDoc 注释
- ❌ 违反: 函数超过 50 行 (第 45-120 行)

#### 经验库匹配
- 💡 参考 EXP-023: 此场景建议使用乐观锁
- ⚠️ 注意 EXP-045: 类似代码曾有并发问题

#### Linus 品味检查
- ✅ 简洁性: 实现直接
- ⚠️ 建议: 第 30 行可简化
- ❌ 问题: 过度抽象 (AuthFactory)

#### 总结
- 通过: 8 项
- 建议: 3 项
- 问题: 2 项

### 沉淀
已记录审查发现到经验库 (EXP-067)
```

## MCP 工具调用
```yaml
必用:
  - sou: 搜索相关代码

推荐:
  - sequential-thinking: 复杂逻辑分析
  - memory: 存储审查经验
```

## 参数说明

| 参数 | 说明 |
|:---|:---|
| --security | 同时调用官方 /security-review |
| --quality | 深度质量检查 (更严格) |
| --quick | 快速检查 (跳过深度分析) |
| --no-deposit | 不沉淀经验 |

## 使用示例

### 标准审查
```bash
vibe-review

# 执行:
# 1. /review (官方)
# 2. 知识库规范检查
# 3. 经验库匹配
# 4. Linus 品味检查
# 5. 沉淀发现
```

### 含安全审查
```bash
vibe-review --security

# 执行:
# 1. /review (官方)
# 2. /security-review (官方)
# 3. VibeCoding 增强
```

### 审查指定文件
```bash
vibe-review src/auth/login.ts

# 仅审查指定文件
```

## 经验沉淀
```yaml
自动沉淀:
  - 发现的重要问题
  - 好的代码实践
  - 新的审查点

格式:
  类型: pitfall | best-practice
  来源: vibe-review
  关联: 审查的文件/PR
```
