# RIPER-10 执行循环 (v7.5 详细版)

> **RIPER = Research → Innovate → Plan → Execute → Review**
> **不是对话流程，是工程执行流程**

---

## 🔄 流程总览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           RIPER-10 总览                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐  │
│  │   R1    │──▶│    I    │──▶│    P    │──▶│    E    │──▶│   R2    │  │
│  │RESEARCH │   │INNOVATE │   │  PLAN   │   │ EXECUTE │   │ REVIEW  │  │
│  └─────────┘   └─────────┘   └─────────┘   └─────────┘   └─────────┘  │
│                                                                         │
│  感知理解      方案设计      生成TODO      执行开发      核对验收      │
│  ─────────    ─────────     ─────────    ─────────     ─────────      │
│  角色: PDM    角色: AR      角色: PM     角色: LD      角色: QE       │
│  工具: sou    工具: thinking 工具: meeting 工具: engine 工具: verify  │
│               寸止↓         寸止↓                      寸止↓          │
│              DESIGN_FREEZE  PLAN_READY                TASK_DONE       │
│                                                                         │
│  产出物:      产出物:       产出物:      产出物:       产出物:        │
│  ·需求摘要    ·数据结构     ·TODO列表    ·代码文件     ·核对报告      │
│  ·代码定位    ·方案对比     ·kanban      ·状态更新     ·寸止确认      │
│               ·设计文档     ·依赖图      ·学习记录                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# R1 - RESEARCH (感知理解)

## 目标
深入理解需求和代码上下文，为后续阶段奠定基础。

## 主导角色
PDM (产品经理)

## 详细步骤

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     R1 - RESEARCH 详细步骤                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP R1.1: 状态恢复                                               │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 执行动作:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ 1. 读取 project_document/.ai_state/session.lock             │  │ │
│  │ │    IF 存在 → 执行工作流恢复协议                             │  │ │
│  │ │    IF 不存在 → 创建新会话锁                                 │  │ │
│  │ │                                                             │  │ │
│  │ │ 2. 读取 project_document/.ai_state/active_context.md        │  │ │
│  │ │    检查是否有未完成任务                                     │  │ │
│  │ │                                                             │  │ │
│  │ │ 3. 读取 project_document/.ai_state/kanban.md                │  │ │
│  │ │    了解项目当前进度                                         │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 产出物:                                                           │ │
│  │ - session.lock (如新建)                                          │ │
│  │ - 状态恢复摘要                                                   │ │
│  │                                                                   │ │
│  │ 检查点:                                                           │ │
│  │ - [ ] 会话锁已检查/创建                                          │ │
│  │ - [ ] 项目状态已读取                                             │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP R1.2: 加载 Memory                                            │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 执行动作:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ // 必须加载的 Memory 类别                                   │  │ │
│  │ │                                                             │  │ │
│  │ │ const userPrefs = await memory.recall({                     │  │ │
│  │ │   category: "user_preference"                               │  │ │
│  │ │ });                                                         │  │ │
│  │ │                                                             │  │ │
│  │ │ const forbidden = await memory.recall({                     │  │ │
│  │ │   category: "forbidden_action"                              │  │ │
│  │ │ });                                                         │  │ │
│  │ │                                                             │  │ │
│  │ │ const patterns = await memory.recall({                      │  │ │
│  │ │   category: "code_pattern"                                  │  │ │
│  │ │ });                                                         │  │ │
│  │ │                                                             │  │ │
│  │ │ const lessons = await memory.recall({                       │  │ │
│  │ │   category: "lesson_learned"                                │  │ │
│  │ │ });                                                         │  │ │
│  │ │                                                             │  │ │
│  │ │ // 应用到当前会话                                           │  │ │
│  │ │ applyKnowledge({ userPrefs, forbidden, patterns, lessons });│  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 产出物:                                                           │ │
│  │ - 加载的用户偏好列表                                             │ │
│  │ - 加载的禁止动作列表                                             │ │
│  │ - 加载的代码模式列表                                             │ │
│  │                                                                   │ │
│  │ 检查点:                                                           │ │
│  │ - [ ] user_preference 已加载                                     │ │
│  │ - [ ] forbidden_action 已加载                                    │ │
│  │ - [ ] code_pattern 已加载                                        │ │
│  │ - [ ] lesson_learned 已加载                                      │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP R1.3: 代码搜索与理解                                         │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 执行动作:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ 1. 使用 sou (augment) 搜索相关代码                          │  │ │
│  │ │    sou.search("[关键词]")                                   │  │ │
│  │ │                                                             │  │ │
│  │ │ 2. 只读取直接相关的文件（不要读整个项目）                   │  │ │
│  │ │    - 目标文件                                               │  │ │
│  │ │    - 依赖文件                                               │  │ │
│  │ │    - 相关类型定义                                           │  │ │
│  │ │                                                             │  │ │
│  │ │ 3. 读取项目约定                                             │  │ │
│  │ │    project_document/.ai_state/conventions.md                │  │ │
│  │ │                                                             │  │ │
│  │ │ 4. 识别现有模式                                             │  │ │
│  │ │    - 命名规范                                               │  │ │
│  │ │    - 代码风格                                               │  │ │
│  │ │    - 架构模式                                               │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 产出物:                                                           │ │
│  │ - 相关代码位置清单                                               │ │
│  │ - 识别的模式和约定                                               │ │
│  │                                                                   │ │
│  │ 检查点:                                                           │ │
│  │ - [ ] 相关代码已定位                                             │ │
│  │ - [ ] 依赖关系已识别                                             │ │
│  │ - [ ] 项目约定已理解                                             │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP R1.4: 需求澄清                                               │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 执行动作:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ IF 需求存在歧义:                                            │  │ │
│  │ │                                                             │  │ │
│  │ │   使用寸止协议暂停（不是直接询问）                          │  │ │
│  │ │                                                             │  │ │
│  │ │   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │ │
│  │ │   📋 需求澄清                                              │  │ │
│  │ │                                                             │  │ │
│  │ │   我理解你需要: [当前理解]                                  │  │ │
│  │ │                                                             │  │ │
│  │ │   需要确认:                                                 │  │ │
│  │ │   1. [具体问题1]                                            │  │ │
│  │ │   2. [具体问题2]                                            │  │ │
│  │ │                                                             │  │ │
│  │ │   请确认或补充                                              │  │ │
│  │ │   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │ │
│  │ │                                                             │  │ │
│  │ │ ⚠️ 禁止猜测！不确定就澄清！                                 │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 产出物:                                                           │ │
│  │ - 澄清后的需求描述                                               │ │
│  │ - 明确的边界和约束                                               │ │
│  │                                                                   │ │
│  │ 检查点:                                                           │ │
│  │ - [ ] 需求已完全理解                                             │ │
│  │ - [ ] 边界已明确                                                 │ │
│  │ - [ ] 无歧义                                                     │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  R1 阶段总产出物:                                                       │
│  ──────────────────────────────────────────────────────────────────── │
│  ✅ session.lock (新建或更新)                                          │
│  ✅ Memory 加载记录                                                     │
│  ✅ 相关代码位置清单                                                    │
│  ✅ 需求理解摘要                                                        │
│  ✅ workflow_state.json (phase: RESEARCH → INNOVATE)                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# I - INNOVATE (方案设计)

## 目标
设计技术方案，遵循 Data First 原则。

## 主导角色
AR (架构师)

## 适用条件
- Path B 和 Path C 必须执行
- Path A 可跳过

## 详细步骤

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     I - INNOVATE 详细步骤                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP I.1: 问题分解（第一性原理）                                  │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 执行动作:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ 问自己三个问题:                                             │  │ │
│  │ │                                                             │  │ │
│  │ │ 1. 这个需求的本质是什么？                                   │  │ │
│  │ │    - 去掉所有表面描述，核心要解决什么问题？                 │  │ │
│  │ │                                                             │  │ │
│  │ │ 2. 去掉所有假设后，还剩什么？                               │  │ │
│  │ │    - 哪些是真正的约束？                                     │  │ │
│  │ │    - 哪些是可以改变的？                                     │  │ │
│  │ │                                                             │  │ │
│  │ │ 3. 最简方案是什么？                                         │  │ │
│  │ │    - 能用最少的代码实现吗？                                 │  │ │
│  │ │    - 有现成方案吗？                                         │  │ │
│  │ │                                                             │  │ │
│  │ │ 示例:                                                       │  │ │
│  │ │ 需求: "实现用户认证"                                        │  │ │
│  │ │ ↓ 分解                                                      │  │ │
│  │ │ 1. 本质: 验证用户身份                                       │  │ │
│  │ │ 2. 核心: 凭证存储 + 验证逻辑 + 会话管理                     │  │ │
│  │ │ 3. 最简: JWT 无状态认证                                     │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 产出物:                                                           │ │
│  │ - 问题分解文档                                                   │ │
│  │ - 核心约束清单                                                   │ │
│  │                                                                   │ │
│  │ 检查点:                                                           │ │
│  │ - [ ] 问题本质已识别                                             │ │
│  │ - [ ] 约束已区分（真实 vs 假设）                                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP I.2: 数据结构设计 (Data First)                               │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 执行动作:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ // 先定义数据，再写逻辑                                     │  │ │
│  │ │                                                             │  │ │
│  │ │ // Step 1: 定义核心实体                                     │  │ │
│  │ │ interface User {                                            │  │ │
│  │ │   id: string;                                               │  │ │
│  │ │   email: string;                                            │  │ │
│  │ │   passwordHash: string;                                     │  │ │
│  │ │   createdAt: Date;                                          │  │ │
│  │ │ }                                                           │  │ │
│  │ │                                                             │  │ │
│  │ │ // Step 2: 定义输入输出                                     │  │ │
│  │ │ interface LoginRequest {                                    │  │ │
│  │ │   email: string;                                            │  │ │
│  │ │   password: string;                                         │  │ │
│  │ │ }                                                           │  │ │
│  │ │                                                             │  │ │
│  │ │ interface LoginResponse {                                   │  │ │
│  │ │   token: string;                                            │  │ │
│  │ │   user: Omit<User, 'passwordHash'>;                         │  │ │
│  │ │ }                                                           │  │ │
│  │ │                                                             │  │ │
│  │ │ // Step 3: 自问                                             │  │ │
│  │ │ // - 这是最简的结构吗？                                     │  │ │
│  │ │ // - 能删掉什么字段？                                       │  │ │
│  │ │ // - 命名准确吗？                                           │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 产出物:                                                           │ │
│  │ - Interface/Type 定义文件                                        │ │
│  │ - 数据流图                                                       │ │
│  │                                                                   │ │
│  │ 检查点:                                                           │ │
│  │ - [ ] 核心实体已定义                                             │ │
│  │ - [ ] 输入输出已定义                                             │ │
│  │ - [ ] 无冗余字段                                                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP I.3: 方案对比                                                │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 执行动作:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ 生成 2-3 个可行方案:                                        │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 方案对比                                                 │  │ │
│  │ │                                                             │  │ │
│  │ │ | 维度 | 方案A: JWT | 方案B: Session |                     │  │ │
│  │ │ |------|-----------|----------------|                     │  │ │
│  │ │ | 数据结构 | 无状态Token | 服务端Session |                │  │ │
│  │ │ | 复杂度 | 低 | 中 |                                       │  │ │
│  │ │ | 可扩展性 | 高 | 中 |                                     │  │ │
│  │ │ | 安全性 | 中 | 高 |                                       │  │ │
│  │ │ | 性能 | 高 | 中 |                                         │  │ │
│  │ │ | 实现难度 | 低 | 中 |                                     │  │ │
│  │ │ | Linus评分 | 4/5 | 3/5 |                                  │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 推荐                                                     │  │ │
│  │ │ 方案A (JWT)                                                 │  │ │
│  │ │ 理由: 简单、无状态、易扩展                                  │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 产出物:                                                           │ │
│  │ - 方案对比表                                                     │ │
│  │ - 推荐方案及理由                                                 │ │
│  │                                                                   │ │
│  │ 检查点:                                                           │ │
│  │ - [ ] 至少2个方案                                                │ │
│  │ - [ ] 对比维度完整                                               │ │
│  │ - [ ] 有明确推荐                                                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP I.4: Linus 审查                                              │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 执行动作:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ ## Linus 审查清单                                           │  │ │
│  │ │                                                             │  │ │
│  │ │ - [ ] **Data First**: 数据结构是最简的吗？                  │  │ │
│  │ │       - 能删掉什么字段？                                    │  │ │
│  │ │       - 有冗余吗？                                          │  │ │
│  │ │                                                             │  │ │
│  │ │ - [ ] **Naming**: 命名准确反映本质？                        │  │ │
│  │ │       - 看名字就知道是什么？                                │  │ │
│  │ │       - 符合项目约定？                                      │  │ │
│  │ │                                                             │  │ │
│  │ │ - [ ] **Simplicity**: 是否过度设计？                        │  │ │
│  │ │       - 有不需要的抽象吗？                                  │  │ │
│  │ │       - 能更简单吗？                                        │  │ │
│  │ │                                                             │  │ │
│  │ │ - [ ] **Compatibility**: 向后兼容？                         │  │ │
│  │ │       - 会破坏现有功能吗？                                  │  │ │
│  │ │                                                             │  │ │
│  │ │ - [ ] **Taste**: 设计有"品味"吗？                           │  │ │
│  │ │       - 优雅吗？                                            │  │ │
│  │ │       - 会让人说"这样设计真好"吗？                          │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 产出物:                                                           │ │
│  │ - Linus 审查报告                                                 │ │
│  │                                                                   │ │
│  │ 检查点:                                                           │ │
│  │ - [ ] 5项全部通过                                                │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP I.5: 寸止 - 设计确认 [DESIGN_FREEZE]                         │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 输出:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │ │
│  │ │ 📋 [DESIGN_FREEZE] 架构设计完成                            │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 数据结构                                                 │  │ │
│  │ │ ```typescript                                               │  │ │
│  │ │ [Interface 定义]                                            │  │ │
│  │ │ ```                                                         │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 方案对比                                                 │  │ │
│  │ │ [对比表]                                                    │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 推荐方案                                                 │  │ │
│  │ │ 方案A (JWT)，理由: 简单、易扩展                            │  │ │
│  │ │                                                             │  │ │
│  │ │ ## Linus 审查                                               │  │ │
│  │ │ ✅ 全部通过                                                 │  │ │
│  │ │                                                             │  │ │
│  │ │ 请选择: A / B / 讨论                                        │  │ │
│  │ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │ │
│  │ │                                                             │  │ │
│  │ │ ⚠️ 禁止自作主张！必须等待用户选择！                        │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 等待用户响应:                                                     │ │
│  │ - A/B → 记录选择，继续下一阶段                                   │ │
│  │ - 讨论 → 进一步澄清                                              │ │
│  │                                                                   │ │
│  │ 产出物:                                                           │ │
│  │ - 用户选择记录                                                   │ │
│  │ - decisions.md 更新                                              │ │
│  │ - workflow_state.json (phase: INNOVATE → PLAN)                   │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  I 阶段总产出物:                                                        │
│  ──────────────────────────────────────────────────────────────────── │
│  ✅ 问题分解文档                                                       │
│  ✅ 数据结构定义 (Interface)                                           │
│  ✅ 方案对比表                                                         │
│  ✅ Linus 审查报告                                                     │
│  ✅ 用户选择记录                                                       │
│  ✅ decisions.md 更新                                                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# P - PLAN (生成TODO)

## 目标
将设计转化为可执行的 TODO 列表，更新 kanban。

## 主导角色
PM (项目经理)

## 详细步骤

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       P - PLAN 详细步骤                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP P.1: 任务分解                                                │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 原则:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ 1. MECE原则（互斥穷尽）                                     │  │ │
│  │ │    - 任务之间不重叠                                         │  │ │
│  │ │    - 任务总和覆盖全部需求                                   │  │ │
│  │ │                                                             │  │ │
│  │ │ 2. 粒度控制                                                 │  │ │
│  │ │    - 每个任务 < 4小时                                       │  │ │
│  │ │    - 太大则继续拆分                                         │  │ │
│  │ │                                                             │  │ │
│  │ │ 3. 验收明确                                                 │  │ │
│  │ │    - 每个任务有明确的验收标准                               │  │ │
│  │ │    - 可客观判断"完成"                                       │  │ │
│  │ │                                                             │  │ │
│  │ │ 4. 依赖清晰                                                 │  │ │
│  │ │    - 识别任务间的依赖关系                                   │  │ │
│  │ │    - 确定执行顺序                                           │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP P.2: 生成 TODO 列表                                          │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 格式:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ ## 📋 TODO 列表                                             │  │ │
│  │ │                                                             │  │ │
│  │ │ - [ ] T-001: [任务描述]                                     │  │ │
│  │ │   - **文件**: [涉及的文件路径]                              │  │ │
│  │ │   - **依赖**: 无 / T-XXX                                    │  │ │
│  │ │   - **预估**: [时间]                                        │  │ │
│  │ │   - **验收**: [具体的验收标准]                              │  │ │
│  │ │   - **Owner**: LD                                           │  │ │
│  │ │                                                             │  │ │
│  │ │ - [ ] T-002: [任务描述]                                     │  │ │
│  │ │   - **文件**: [涉及的文件路径]                              │  │ │
│  │ │   - **依赖**: T-001                                         │  │ │
│  │ │   - **预估**: [时间]                                        │  │ │
│  │ │   - **验收**: [具体的验收标准]                              │  │ │
│  │ │   - **Owner**: LD                                           │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 写入: active_context.md                                          │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP P.3: 更新 kanban.md                                          │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 格式:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ # 📋 项目看板                                               │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 📊 整体进度                                              │  │ │
│  │ │ ░░░░░░░░░░░░░░░░░░░░ 0% (0/5)                              │  │ │
│  │ │                                                             │  │ │
│  │ │ ---                                                         │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 📥 TODO (待办)                                           │  │ │
│  │ │ | ID | 任务 | 预估 | 依赖 |                                │  │ │
│  │ │ |:---|:---|:---|:---|                                      │  │ │
│  │ │ | T-001 | 数据模型定义 | 30min | - |                       │  │ │
│  │ │ | T-002 | API接口实现 | 1h | T-001 |                       │  │ │
│  │ │ | T-003 | 前端组件 | 1h | T-002 |                          │  │ │
│  │ │ | T-004 | 集成测试 | 30min | T-003 |                       │  │ │
│  │ │ | T-005 | 文档更新 | 20min | T-004 |                       │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 🔄 DOING (进行中)                                        │  │ │
│  │ │ | ID | 任务 | 开始时间 | 进度 |                            │  │ │
│  │ │ |:---|:---|:---|:---|                                      │  │ │
│  │ │ (空)                                                        │  │ │
│  │ │                                                             │  │ │
│  │ │ ## ✅ DONE (已完成)                                         │  │ │
│  │ │ | ID | 任务 | 用时 | 完成时间 |                            │  │ │
│  │ │ |:---|:---|:---|:---|                                      │  │ │
│  │ │ (空)                                                        │  │ │
│  │ │                                                             │  │ │
│  │ │ ---                                                         │  │ │
│  │ │ 更新时间: [时间戳]                                          │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ ⚠️ 重要: kanban 必须有三个栏: TODO / DOING / DONE               │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP P.4: 寸止 - 计划确认 [PLAN_READY]                            │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 输出:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │ │
│  │ │ 📋 [PLAN_READY] 任务计划已生成                             │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 任务概览                                                 │  │ │
│  │ │ - 总任务: 5 个                                              │  │ │
│  │ │ - 预估时间: 3小时20分钟                                     │  │ │
│  │ │ - 涉及文件: 4 个                                            │  │ │
│  │ │                                                             │  │ │
│  │ │ ## TODO 列表                                                │  │ │
│  │ │ 1. T-001: 数据模型定义 (30min)                             │  │ │
│  │ │ 2. T-002: API接口实现 (1h) → 依赖T-001                     │  │ │
│  │ │ 3. T-003: 前端组件 (1h) → 依赖T-002                        │  │ │
│  │ │ 4. T-004: 集成测试 (30min) → 依赖T-003                     │  │ │
│  │ │ 5. T-005: 文档更新 (20min) → 依赖T-004                     │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 执行顺序                                                 │  │ │
│  │ │ T-001 → T-002 → T-003 → T-004 → T-005                      │  │ │
│  │ │                                                             │  │ │
│  │ │ 请确认: 确认 / 修改 / 取消                                  │  │ │
│  │ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 等待用户响应:                                                     │ │
│  │ - 确认 → 继续执行阶段                                            │ │
│  │ - 修改 → 返回调整TODO                                            │ │
│  │ - 取消 → 删除session.lock，结束                                  │ │
│  │                                                                   │ │
│  │ 产出物:                                                           │ │
│  │ - 用户确认记录                                                   │ │
│  │ - workflow_state.json (phase: PLAN → EXECUTE)                    │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  P 阶段总产出物:                                                        │
│  ──────────────────────────────────────────────────────────────────── │
│  ✅ TODO 列表 (active_context.md)                                      │
│  ✅ kanban.md (TODO栏填充)                                             │
│  ✅ 依赖关系图                                                         │
│  ✅ 用户确认记录                                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# E - EXECUTE (执行开发)

## 目标
逐项执行 TODO，更新 kanban 状态。

## 主导角色
LD (开发工程师)

## 详细步骤

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      E - EXECUTE 详细步骤                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  FOR EACH task IN TODO_LIST:                                            │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP E.1: 执行前检查                                              │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 检查清单:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ - [ ] 依赖任务已完成？                                      │  │ │
│  │ │       IF 未完成 → 跳过，执行下一个无依赖任务                │  │ │
│  │ │                                                             │  │ │
│  │ │ - [ ] 检查 forbidden_action                                 │  │ │
│  │ │       const forbidden = await memory.recall({               │  │ │
│  │ │         category: "forbidden_action"                        │  │ │
│  │ │       });                                                   │  │ │
│  │ │       FOR EACH rule IN forbidden:                           │  │ │
│  │ │         IF task.violates(rule) → 阻止执行，提示用户         │  │ │
│  │ │                                                             │  │ │
│  │ │ - [ ] 加载 code-simplifier skill                            │  │ │
│  │ │                                                             │  │ │
│  │ │ - [ ] 读取相关文档和代码                                    │  │ │
│  │ │       - 目标文件                                            │  │ │
│  │ │       - 类型定义                                            │  │ │
│  │ │       - 项目约定                                            │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP E.2: 更新 kanban (TODO → DOING)                              │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 操作:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ 1. 从 TODO 栏移除任务                                       │  │ │
│  │ │ 2. 添加到 DOING 栏，记录开始时间                            │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 🔄 DOING (进行中)                                        │  │ │
│  │ │ | ID | 任务 | 开始时间 | 进度 |                            │  │ │
│  │ │ |:---|:---|:---|:---|                                      │  │ │
│  │ │ | T-001 | 数据模型定义 | 10:30 | 0% |                      │  │ │
│  │ │                                                             │  │ │
│  │ │ 3. 更新进度条                                               │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP E.3: 执行任务                                                │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 执行规范:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ 代码质量要求:                                               │  │ │
│  │ │ - 函数 < 50行                                               │  │ │
│  │ │ - 嵌套 < 3层                                                │  │ │
│  │ │ - 无 any 类型                                               │  │ │
│  │ │ - 完整错误处理                                              │  │ │
│  │ │ - 输入验证                                                  │  │ │
│  │ │                                                             │  │ │
│  │ │ 引擎选择:                                                   │  │ │
│  │ │ - 用户指定 → 使用指定引擎                                   │  │ │
│  │ │ - 配置指定 → 读取 orchestrator.yaml                         │  │ │
│  │ │ - 默认 → Claude 原生执行                                    │  │ │
│  │ │                                                             │  │ │
│  │ │ 过程中更新 kanban 进度:                                     │  │ │
│  │ │ | T-001 | 数据模型定义 | 10:30 | 60% |                      │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP E.4: 验证                                                    │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 验证流程:                                                         │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │                                                             │  │ │
│  │ │  Execute → Verify → Pass? ──Yes──▶ STEP E.5               │  │ │
│  │ │                       │                                     │  │ │
│  │ │                       No                                    │  │ │
│  │ │                       ↓                                     │  │ │
│  │ │              Analyze → Fix → Retry (max 3)                  │  │ │
│  │ │                              │                              │  │ │
│  │ │                              Fail                           │  │ │
│  │ │                              ↓                              │  │ │
│  │ │                   [VERIFICATION_FAILED]                     │  │ │
│  │ │                        寸止                                 │  │ │
│  │ │                                                             │  │ │
│  │ │ 验证检查:                                                   │  │ │
│  │ │ - [ ] 代码编译通过                                          │  │ │
│  │ │ - [ ] 相关测试通过                                          │  │ │
│  │ │ - [ ] 满足验收标准                                          │  │ │
│  │ │ - [ ] 无新增错误                                            │  │ │
│  │ │                                                             │  │ │
│  │ │ 验证失败时触发 error-learning:                              │  │ │
│  │ │ - 分析错误原因                                              │  │ │
│  │ │ - 记录到 Memory (lesson_learned)                            │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP E.5: 更新状态 (DOING → DONE)                                 │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 操作:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ 1. 从 DOING 栏移除任务                                      │  │ │
│  │ │ 2. 添加到 DONE 栏，记录实际用时                             │  │ │
│  │ │                                                             │  │ │
│  │ │ ## ✅ DONE (已完成)                                         │  │ │
│  │ │ | ID | 任务 | 用时 | 完成时间 |                            │  │ │
│  │ │ |:---|:---|:---|:---|                                      │  │ │
│  │ │ | T-001 | 数据模型定义 | 25min | 10:55 |                   │  │ │
│  │ │                                                             │  │ │
│  │ │ 3. 更新 active_context.md                                   │  │ │
│  │ │    - [x] T-001: 数据模型定义 ✅                             │  │ │
│  │ │                                                             │  │ │
│  │ │ 4. 更新进度条                                               │  │ │
│  │ │    ████░░░░░░░░░░░░░░░░ 20% (1/5)                          │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP E.6: 学习沉淀                                                │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 检查并记录:                                                       │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ IF 发现新的代码模式:                                        │  │ │
│  │ │   memory.add({                                              │  │ │
│  │ │     category: "code_pattern",                               │  │ │
│  │ │     content: "[模式描述]",                                  │  │ │
│  │ │     tags: ["具体领域"]                                      │  │ │
│  │ │   });                                                       │  │ │
│  │ │                                                             │  │ │
│  │ │ IF 修复了错误:                                              │  │ │
│  │ │   memory.add({                                              │  │ │
│  │ │     category: "lesson_learned",                             │  │ │
│  │ │     content: "[错误原因和教训]",                            │  │ │
│  │ │     tags: ["错误类型"]                                      │  │ │
│  │ │   });                                                       │  │ │
│  │ │                                                             │  │ │
│  │ │ IF 发现高频动作:                                            │  │ │
│  │ │   memory.add({                                              │  │ │
│  │ │     category: "high_freq_action",                           │  │ │
│  │ │     content: "[动作描述]",                                  │  │ │
│  │ │     tags: ["领域"]                                          │  │ │
│  │ │   });                                                       │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  END FOR                                                                │
│                                                                         │
│  E 阶段总产出物:                                                        │
│  ──────────────────────────────────────────────────────────────────── │
│  ✅ 修改后的代码文件                                                   │
│  ✅ kanban.md (DONE栏填充)                                             │
│  ✅ active_context.md (任务标记完成)                                   │
│  ✅ Memory 学习记录                                                     │
│  ✅ 验证日志                                                           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# R2 - REVIEW (核对验收)

## 目标
根据 TODO 逐项核对，调用寸止与用户确认。

## 主导角色
QE (质量工程师)

## 详细步骤

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      R2 - REVIEW 详细步骤                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP R2.1: 生成 TODO 核对报告                                     │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 格式:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ ## ✅ TODO 核对清单                                         │  │ │
│  │ │                                                             │  │ │
│  │ │ - [x] T-001: 数据模型定义 ✅                                │  │ │
│  │ │   - **计划文件**: src/types/user.ts                         │  │ │
│  │ │   - **实际文件**: src/types/user.ts (+25/-0)                │  │ │
│  │ │   - **预估用时**: 30min                                     │  │ │
│  │ │   - **实际用时**: 25min ✅                                  │  │ │
│  │ │   - **验收标准**: 类型定义完整                              │  │ │
│  │ │   - **验证结果**: TypeScript 编译通过 ✅                    │  │ │
│  │ │                                                             │  │ │
│  │ │ - [x] T-002: API接口实现 ✅                                 │  │ │
│  │ │   - **计划文件**: src/api/auth.ts                           │  │ │
│  │ │   - **实际文件**: src/api/auth.ts (+50/-10)                 │  │ │
│  │ │   - **预估用时**: 1h                                        │  │ │
│  │ │   - **实际用时**: 55min ✅                                  │  │ │
│  │ │   - **验收标准**: 接口可调用                                │  │ │
│  │ │   - **验证结果**: 单元测试通过 ✅                           │  │ │
│  │ │                                                             │  │ │
│  │ │ [继续列出所有任务...]                                       │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP R2.2: 生成执行统计                                           │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 格式:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ ## 📊 执行统计                                              │  │ │
│  │ │                                                             │  │ │
│  │ │ | 指标 | 数值 |                                             │  │ │
│  │ │ |:---|:---|                                                │  │ │
│  │ │ | 总任务 | 5 |                                              │  │ │
│  │ │ | 已完成 | 5 (100%) |                                       │  │ │
│  │ │ | 预估时间 | 3h 20min |                                     │  │ │
│  │ │ | 实际时间 | 2h 45min |                                     │  │ │
│  │ │ | 效率 | 121% |                                             │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 📁 变更文件汇总                                          │  │ │
│  │ │                                                             │  │ │
│  │ │ | 文件 | 变更 |                                             │  │ │
│  │ │ |:---|:---|                                                │  │ │
│  │ │ | src/types/user.ts | +25/-0 |                             │  │ │
│  │ │ | src/api/auth.ts | +50/-10 |                              │  │ │
│  │ │ | src/components/Login.tsx | +80/-0 |                      │  │ │
│  │ │ | 总计 | +155/-10 |                                        │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP R2.3: 更新最终 kanban                                        │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 格式:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ # 📋 项目看板                                               │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 📊 整体进度                                              │  │ │
│  │ │ ████████████████████ 100% (5/5) ✅                         │  │ │
│  │ │                                                             │  │ │
│  │ │ ---                                                         │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 📥 TODO (待办)                                           │  │ │
│  │ │ (空)                                                        │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 🔄 DOING (进行中)                                        │  │ │
│  │ │ (空)                                                        │  │ │
│  │ │                                                             │  │ │
│  │ │ ## ✅ DONE (已完成)                                         │  │ │
│  │ │ | ID | 任务 | 用时 | 完成时间 |                            │  │ │
│  │ │ |:---|:---|:---|:---|                                      │  │ │
│  │ │ | T-001 | 数据模型定义 | 25min | 10:55 |                   │  │ │
│  │ │ | T-002 | API接口实现 | 55min | 11:50 |                    │  │ │
│  │ │ | T-003 | 前端组件 | 50min | 12:40 |                       │  │ │
│  │ │ | T-004 | 集成测试 | 25min | 13:05 |                       │  │ │
│  │ │ | T-005 | 文档更新 | 10min | 13:15 |                       │  │ │
│  │ │                                                             │  │ │
│  │ │ ---                                                         │  │ │
│  │ │ 更新时间: [时间戳]                                          │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP R2.4: 调用寸止 [TASK_DONE]                                   │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 输出:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │ │
│  │ │ 📋 [TASK_DONE] 工作流完成                                  │  │ │
│  │ │                                                             │  │ │
│  │ │ ## ✅ TODO 核对清单                                         │  │ │
│  │ │ [核对清单内容]                                              │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 📊 执行统计                                              │  │ │
│  │ │ [统计内容]                                                  │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 📁 变更文件                                              │  │ │
│  │ │ [变更文件列表]                                              │  │ │
│  │ │                                                             │  │ │
│  │ │ ## 🎯 验收选项                                              │  │ │
│  │ │ 1. `通过` - 确认完成，归档工作流                            │  │ │
│  │ │ 2. `问题` - 有问题需要修复                                  │  │ │
│  │ │ 3. `优化` - 需要进一步优化                                  │  │ │
│  │ │                                                             │  │ │
│  │ │ 请选择:                                                     │  │ │
│  │ │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  │                                                                   │ │
│  │ 等待用户响应:                                                     │ │
│  │ - 通过 → 删除session.lock，归档                                  │ │
│  │ - 问题 → 创建修复TODO，返回E阶段                                 │ │
│  │ - 优化 → 创建优化TODO，返回E阶段                                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                              ↓                                          │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │ STEP R2.5: 归档（用户通过后）                                     │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │                                                                   │ │
│  │ 操作:                                                             │ │
│  │ ┌─────────────────────────────────────────────────────────────┐  │ │
│  │ │ 1. 删除 session.lock                                        │  │ │
│  │ │    rm project_document/.ai_state/session.lock               │  │ │
│  │ │                                                             │  │ │
│  │ │ 2. 归档 workflow_state.json                                 │  │ │
│  │ │    mv workflow_state.json archive/WF-001.json               │  │ │
│  │ │                                                             │  │ │
│  │ │ 3. 沉淀学习成果                                             │  │ │
│  │ │    - 记录有价值的模式到 Memory                              │  │ │
│  │ │    - 更新 conventions.md (如有新约定)                       │  │ │
│  │ │                                                             │  │ │
│  │ │ 4. 清理 active_context.md                                   │  │ │
│  │ │    - 重置为初始状态                                         │  │ │
│  │ │    - 或保留作为历史记录                                     │  │ │
│  │ └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  R2 阶段总产出物:                                                       │
│  ──────────────────────────────────────────────────────────────────── │
│  ✅ TODO 核对报告                                                      │
│  ✅ 执行统计报告                                                       │
│  ✅ 最终 kanban.md                                                     │
│  ✅ 寸止确认记录                                                       │
│  ✅ 归档的工作流状态                                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📋 RIPER 阶段产出物总表

| 阶段 | 产出物 |
|:---|:---|
| **R1** | session.lock, Memory加载记录, 代码位置清单, 需求摘要 |
| **I** | 问题分解文档, 数据结构定义, 方案对比表, Linus审查报告, decisions.md |
| **P** | TODO列表, kanban.md, 依赖图, 用户确认记录 |
| **E** | 代码文件, kanban更新, active_context更新, Memory学习记录 |
| **R2** | TODO核对报告, 执行统计, 最终kanban, 寸止确认, 归档状态 |

---

**版本**: v7.5 | **原则**: 详细步骤 + 明确产出物 + 强制寸止
