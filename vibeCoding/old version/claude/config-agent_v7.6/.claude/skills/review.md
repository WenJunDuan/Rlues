# R2 - REVIEW (核对验收)

> 加载时机：RIPER 第五阶段 | 角色：QE

---

## 执行步骤

### Step 1: 生成 TODO 核对报告
```markdown
## ✅ TODO 核对清单

- [x] T-001: 数据模型定义 ✅
  - **计划文件**: src/types/user.ts
  - **实际文件**: src/types/user.ts (+25/-0)
  - **预估用时**: 30min
  - **实际用时**: 25min ✅
  - **验收标准**: 类型定义完整
  - **验证结果**: TypeScript 编译通过 ✅

- [x] T-002: API接口实现 ✅
  - **计划文件**: src/api/auth.ts
  - **实际文件**: src/api/auth.ts (+50/-10)
  - **预估用时**: 1h
  - **实际用时**: 55min ✅
  - **验收标准**: 接口可调用
  - **验证结果**: 单元测试通过 ✅
```

### Step 2: 生成执行统计
```markdown
## 📊 执行统计

| 指标 | 数值 |
|:---|:---|
| 总任务 | 5 |
| 已完成 | 5 (100%) |
| 预估时间 | 3h 20min |
| 实际时间 | 2h 45min |
| 效率 | 121% |

## 📁 变更文件汇总

| 文件 | 变更 |
|:---|:---|
| src/types/user.ts | +25/-0 |
| src/api/auth.ts | +50/-10 |
| 总计 | +75/-10 |
```

### Step 3: 确认 kanban 最终状态
```markdown
## 📊 整体进度
████████████████████ 100% (5/5) ✅

## 📥 TODO (待办)
(空)

## 🔄 DOING (进行中)
(空)

## ✅ DONE (已完成)
| ID | 任务 | 用时 | 完成时间 |
|:---|:---|:---|:---|
| T-001 | xxx | 25min | 10:55 |
| T-002 | xxx | 55min | 11:50 |
| ... | ... | ... | ... |
```

### Step 4: 寸止 [TASK_DONE]
```
调用 cunzhi MCP（或 mcp-feedback）

输出：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 [TASK_DONE] 工作流完成

[TODO 核对清单]
[执行统计]
[变更文件汇总]

🎯 验收选项：
1. 通过 - 确认完成，归档工作流
2. 问题 - 有问题需要修复
3. 优化 - 需要进一步优化

请选择：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ 必须调用工具等待用户响应！
```

### Step 5: 根据用户响应处理
```
用户选择：
- 通过 → 执行归档（Step 6）
- 问题 → 创建修复 TODO，返回 E 阶段
- 优化 → 创建优化 TODO，返回 E 阶段
```

### Step 6: 归档（用户通过后）
```bash
# 1. 删除 session.lock
rm .ai_state/session.lock

# 2. 归档工作流状态（可选）
mv .ai_state/workflow_state.json .ai_state/archive/

# 3. 沉淀学习成果
memory.add({ category: "...", content: "..." })

# 4. 清理或保留 active_context.md
```

---

## 产出物

- [ ] TODO 核对报告
- [ ] 执行统计报告
- [ ] 最终 kanban.md
- [ ] 寸止确认记录
- [ ] 归档的工作流状态

---

## 检查点

- [ ] 每个 TODO 都已核对
- [ ] 统计数据完整
- [ ] kanban 三栏状态正确
- [ ] 已调用寸止等待用户
- [ ] 用户确认后已归档

---

## 完成后

工作流结束，等待新任务
